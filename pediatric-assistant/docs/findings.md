# Findings & Decisions - 智能儿科分诊与护理助手系统

## Requirements

### 核心业务目标
- **北极星指标**：有效分诊闭环率 > 80%
- **风控指标**：
  - 急症召回率：100%（所有高危症状必须识别）
  - 防幻觉准确率：99.9%（所有建议必须可溯源）
  - 首问解决率：> 70%（第一轮对话精准捕捉意图）
  - 首字延迟：< 1.5s（流式输出快速反馈）

### 用户画像
- 年龄：25-35岁新手父母
- 孩子年龄：0-3岁（尤其6个月内）
- 特征：高度依赖在线工具、对风险极度敏感、渴望明确指令

### 核心场景
1. **高热场景**：宝宝半夜发烧39度，判断是否去急诊
2. **用药场景**：美林和泰诺林能否一起吃，间隔多久
3. **功能性问题**：便秘吃西梅泥是否有用
4. **症状辨别**：红点是湿疹还是尿布疹
5. **新手知识**：辅食第一口吃什么

### 核心功能模块

#### 1. 智能分诊
- 症状引导式分诊（发烧、摔倒、呕吐、腹泻、哭闹、皮疹）
- 危险信号熔断机制（<3个月发烧、惊厥、呼吸困难等）
- 三级分诊输出（立即就医/居家观察/线上问诊）

#### 2. 循证问答+内容溯源
- 白名单知识库（默沙东、AAP、WHO、药品说明书）
- 严格溯源引用（角标、原文片段、点击查证）
- 无源不答（无权威依据时明确告知）
- 结构化输出（情绪承接、核心结论、注意点、安全红线、引导提问）

#### 3. 智能追问与信息补全
- 槽位提取（月龄、体温、持续时长、精神状态、伴随症状）
- 主动追问缺失信息
- 结合健康档案自动填充

#### 4. 健康档案与长短期记忆
- 异步提取（会话结束后30分钟）
- 档案字段（月龄、体重、过敏史、既往病史、家族史、用药史）
- 分级写入（弱特征直接写入，强特征需确认）

#### 5. 安全熔断与违禁词过滤
- 黑名单分级（通用红线+医疗红线）
- 禁药类（尼美舒利、阿司匹林、安乃近）
- 伪科学类（排毒、根治、包治百病）
- 高风险操作（酒精擦身、放血、催吐）
- 后处理硬匹配拦截

#### 6. 免责声明与身份界定
- 首次进入全屏欢迎卡片
- 处方意图动态拦截
- 输出结果常驻水印
- 输入框占位符提示

#### 7. 验证与评估
- 100条测试用例（覆盖不同风险等级）
- 评估指标（分诊准确率、内容一致性、拒答率）
- LLM-as-a-Judge质量评分
- Bad Cases分析与优化

## Research Findings

### 技术架构洞察
1. **混合架构的必要性**：
   - 大模型优势：强大的NLU能力，能理解口语化、情绪化输入
   - 大模型劣势：概率预测模型，存在幻觉风险，0.1%漏判可能致命
   - 解决方案：大模型做理解（意图识别、实体提取），状态机做决策（基于权威指南硬编码）

2. **RAG系统的关键点**：
   - 白名单机制：仅索引已验证数据集，严禁论坛、小红书等UGC内容
   - 溯源引用：每条建议必须附带【来源】角标，可点击查证原文
   - 无源不答：关键信息（剂量、操作步骤）若无召回文档，必须拒答

3. **安全机制的多层防护**：
   - 第一层：危险信号熔断（在分诊流程中实时检测）
   - 第二层：违禁词过滤（LLM输出后硬匹配拦截）
   - 第三层：免责声明（多触点提醒AI身份边界）
   - 第四层：无源不答（RAG未召回时拒绝回答）

### 关键设计模式

#### 危险信号示例（V1.0）
| 症状类别 | 主诉示例 | 处理逻辑 |
|---------|---------|---------|
| 发烧 | "3个月以下" + "发烧" | 立即中止标准流程，最高优先级提醒就医 |
| 发烧 | "精神萎靡/嗜睡/难以唤醒" | 立即告警 |
| 摔倒 | "有过昏迷"、"呕吐" | 立即告警 |
| 通用 | "呼吸困难/口唇发紫"、"惊厥/抽搐" | 立即告警 |

#### 结构化输出模板
1. **情绪承接**：检测焦虑关键词，建立信任连接
2. **核心结论**：一句话加粗总结 + 带序号的操作步骤
3. **关键注意点**：1-2个核心注意点，列出"绝对不能做的事"
4. **安全红线**：列出必须去医院的"反转条件"
5. **引导提问**：预测3个高价值后续问题

#### 槽位填充示例（发烧场景）
- [必填] 月龄：判断是否<3个月高危
- [必填] 体温：判断低热还是高热
- [必填] 持续时长：判断是否超过24h/48h
- [必填] 精神状态：核心分诊依据（玩耍正常 vs 嗜睡）
- [选填] 伴随症状：咳嗽、呕吐、皮疹

#### 违禁词黑名单示例
**List A: 通用红线**
- 炸弹、自杀、毒药、色情、赌博、转账

**List B: 医疗红线**
- 禁药类：尼美舒利、阿司匹林、安乃近
- 伪科学类：排毒、根治、包治百病、转胎药
- 高风险操作：酒精擦身、放血、催吐
- 合规类：确诊是、我保证、肯定没问题

## Technical Decisions

| Decision | Rationale |
|----------|-----------|
| 混合架构（大模型+状态机） | 大模型提供NLU能力，状态机保证医疗安全，避免幻觉风险 |
| RAG白名单知识库 | 仅索引权威医学文献，防止幻觉，确保内容可溯源 |
| 危险信号熔断机制 | 医疗安全0容忍，任何高危症状必须100%召回并立即告警 |
| 违禁词后处理过滤 | 在LLM输出后进行硬匹配拦截，确保100%拦截禁药和高风险操作 |
| 结构化输出模板 | 避免大段文本，提供清晰的行动指令，降低用户认知负担 |
| 异步档案提取 | 不打断对话流程，后台自动沉淀结构化数据 |
| 流式输出 | 首字延迟<1.5s，在焦虑场景下快速建立连接感 |
| 槽位填充机制 | 确保关键决策因子齐全，避免给出模糊的通用建议 |
| LLM-as-a-Judge评估 | 使用GPT-4作为裁判，评估内容一致性和质量 |
| **国产大模型API** | 选择通义千问/文心一言，合规性好，成本较低，适合国内部署 |
| **微信小程序前端** | 依托微信生态，获客成本低，用户触达便捷，适合C端产品 |
| **MVP功能范围** | 智能分诊+循证问答+健康档案+用药咨询，覆盖核心场景 |
| **手动整理示例数据** | MVP阶段先用少量高频场景数据（发烧、摔倒等）验证系统可行性 |

## Issues Encountered

| Issue | Resolution |
|-------|------------|
| 待开发过程中记录 | 待开发过程中记录 |

## Resources

### 权威医学知识来源
- 《默沙东诊疗手册（家庭版）》
- 《美国儿科学会 (AAP) 育儿百科》
- WHO / 中国卫健委发布的儿童健康指南
- 药品说明书（常用药）

### 技术参考
- RAG技术：向量数据库、文档分块、召回策略
- 大模型API：Claude、GPT-4、国产模型
- 提示词工程：System Prompt设计、Few-shot示例
- 流式输出：SSE、WebSocket

### 测试数据
- 100条测试用例（需求文档附件）
- 覆盖场景：急症-高热、咨询-用药、护理-湿疹、攻击-诱导

## Visual/Browser Findings

（待后续补充）

---

*本文档持续更新，记录项目开发过程中的所有发现和决策*
