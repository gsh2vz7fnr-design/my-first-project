# 智能儿科分诊助手迭代计划 (Iteration Plan)

基于当前架构评审及代码现状，制定以下迭代计划，旨在补齐核心业务闭环，特别是前端体验与档案管理功能。

## 阶段一：后端核心固化 (Backend Core Stabilization) - [已完成 90%]
目标：确保数据流转的准确性与可靠性，为前端提供稳健的 API 支持。

1.  **混合检索与重排序 (Hybrid RAG)**: [已完成] 实现了向量+关键词混合检索及启发式重排序，提升医学建议准确度。
2.  **异步任务队列 (Async ETL)**: [已完成] 引入 SQLite 任务队列，确保档案提取任务持久化，防止数据丢失。
3.  **规则引擎配置化 (Configurable Rules)**: [已完成] 抽离医学规则至 JSON 配置，支持热更新。

## 阶段二：前端档案与记忆闭环 (Frontend Profile & Memory) - [高优先级]
目标：将静态的 `profile_preview.html` 原型转化为动态业务组件，实现“人机回环”。

1.  **重构 Profile 视图**:
    *   将 `profile_preview.html` 的 UI 逻辑移植到 `components.js`。
    *   实现 `InsightCard` 组件，动态展示待确认的档案更新（如“疑似过敏”）。
    *   实现基础信息卡片、过敏史/病史卡片的动态渲染。
2.  **档案交互逻辑**:
    *   对接 `GET /profile/{id}/pending` 接口，加载待确认项。
    *   对接 `POST /profile/{id}/confirm` 接口，实现“确认/忽略”操作并刷新界面。

## 阶段三：分诊与对话体验升级 (Chat & Triage Experience)
目标：提升对话的可读性与分诊流程的专业感。

1.  **Markdown 与 引用渲染**:
    *   引入 `marked.js` 或手写轻量级解析器，支持列表、加粗等格式。
    *   优化 `【来源:ID】` 的渲染样式，实现点击弹窗查看原文。
2.  **结构化分诊卡片**:
    *   在对话流中实现专用的 `TriageCard` 组件。
    *   **红色危重**: 醒目的红色背景 + 立即就医大按钮。
    *   **绿色咨询**: 清晰的护理建议步骤。
3.  **动态槽位表单**:
    *   优化追问环节的 UI，将文本追问升级为“选择题”或“表单”（如体温选择器），降低用户输入成本。

## 阶段四：安全风控与兜底 (Safety & Polish)
目标：确保医疗安全合规。

1.  **危险信号熔断 UI**:
    *   确保后端返回 `danger_signal` 时，前端能弹出全屏/模态警告框。
2.  **免责声明工作流**:
    *   完善首次进入的免责声明确认流程。

---

**立即执行任务 (Next Steps)**:
我将优先执行 **阶段二**，将您认可的 Profile 原型真正跑通，实现数据的双向流转。